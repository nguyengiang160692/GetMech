<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link rel="stylesheet" href='/bootstrap/css/bootstrap.min.css'>
    <link rel="stylesheet" href='/bootstrap/css/bootstrap-theme.min.css'>
    <link rel="stylesheet" href='/bootstrap/css/dashboard.css'>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Info Centre</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <form class="navbar-form navbar-right">
                <input class="form-control" placeholder="Search..." type="text">
            </form>
        </div>
    </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li class="active">
                    <a href="#">Overview
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li>
                    <a data-toggle="modal" data-target="#addLink" href="#">Add Link</a>
                </li>
            </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">Dashboard</h1>
            <div class="row">
                <div class="col-md-12">
                    <table>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="addLink" tabindex="-1" role="dialog" aria-labelledby="addLinkLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="addLinkLabel">Add Link</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Url</label>
                        <div class="col-sm-10">
                            <input name="url" type="text" class="form-control" placeholder="Url to leech">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Title</label>
                        <div class="col-sm-10">
                            <input name="title" type="text" class="form-control" placeholder="Title">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Type</label>
                        <div class="col-sm-10">
                            <select name="fn[fnType]" class="form-control" placeholder="Type">
                                <option value="0">Choose type</option>
                                <option value="searchQuery">searchQuery</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group hide" data-interact="fn[fnType]" data-type="searchQuery">
                        <label class="col-md-2 control-label">Type Params</label>
                        <div class="col-md-2">
                            <button class="btn btn-success" type="button" onclick="formAddLink.fn.addBlock()">
                                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                Add parameter
                            </button>
                        </div>
                    </div>
                    <div class="form-group hide" data-interact="fn[fnType]" data-type="searchQuery">
                        <div class="col-md-10 col-md-offset-2" id="paramBlockList1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Selector</label>
                        <div class="col-sm-10">
                            <input name="selector" type="text" class="form-control" placeholder="Selector like CSS">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <div class="checkbox">
                                <label>
                                    <input name="notify" type="checkbox"> Get notify
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" onclick="formAddLink.addLink()">Add link</button>
            </div>
        </div>
    </div>
</div>
<script src='/bootstrap/js/jquery.js'></script>
<script src='/bootstrap/js/bootstrap.min.js'></script>
<script>
    var formAddLink = {
        addLink:function(){
            var data = $('#addLink form').serializeArray();
            console.log(data);
            $.post('/leecher/addLink', data, function(res){

            });
        },
        fn     :{
            currentIndex:0,
            addBlock    :function(){
                this.currentIndex++;
                var html = '';
                html += ' <div class="form-group">';
                html += '     <div class="col-sm-4">';
                html += '         <input name="fn[fnParams][' + this.currentIndex + '][name]" type="text" class="form-control" placeholder="Name">';
                html += '     </div>';
                html += '     <div class="col-sm-6">';
                html += '         <input name="fn[fnParams][' + this.currentIndex + '][value]" type="text" class="form-control" placeholder="Value">';
                html += '     </div>';
                html += '     <div class="col-sm-2 text-right">';
                html += '         <button class="btn btn-danger" type="button" onclick="formAddLink.fn.removeBlock(this,\'.form-group\')">';
                html += '             <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>';
                html += '         </button>';
                html += '     </div>';
                html += ' </div>';
                $('#paramBlockList1').append(html);
            },
            removeBlock :function(ele, cloestBlock){
                $(ele).closest(cloestBlock).remove();
            }
        }
    };

    function changeType(){
        $("select[name='fn[fnType]']").on('change', function(e){
            function showOptions(type){

                var showType = $('.form-group').filter(function(){
                    return $(this).data('interact') == 'fn[fnType]' && $(this).data('type') == type
                });

                showType.removeClass('hide');
            }

            $('.form-group[data-interact]').addClass('hide');

            var type = $(this).val();
            switch(type){
                case 'searchQuery':
                    showOptions('searchQuery');

                    //bind more here

                    break;
            }
        });
        $("select[name='fn[fnType]']").trigger('change');
    }

    $(document).ready(function(){
        changeType();
    });
</script>
</body>
</html>
